//--------------------------------------------------------------------------------
//　time.h
//  Author : 徐文杰(KodFreedom)
//--------------------------------------------------------------------------------
#pragma once
#include <windows.h>

//--------------------------------------------------------------------------------
//  タイムクラス
//--------------------------------------------------------------------------------
class GameTimer
{
public:
    //--------------------------------------------------------------------------------
    //  Create
    //--------------------------------------------------------------------------------
    static GameTimer* Create();

    //--------------------------------------------------------------------------------
    //  インスタンスを返す
    //--------------------------------------------------------------------------------
    static GameTimer& Instance()
    {
        return *instance_;
    }

    //--------------------------------------------------------------------------------
    //  Initialize処理
    //--------------------------------------------------------------------------------
    void Initialize(HWND main_window_handle);

    //--------------------------------------------------------------------------------
    //  破棄処理
    //--------------------------------------------------------------------------------
    void Release();

    //--------------------------------------------------------------------------------
    //  Delta timeの取得
    //--------------------------------------------------------------------------------
    float DeltaTime() const { return delta_time_; }

    //--------------------------------------------------------------------------------
    //  Time scaleの取得
    //--------------------------------------------------------------------------------
    float TimeScale() const { return time_scale_; }

    //--------------------------------------------------------------------------------
    //  Time scaleの設定
    //--------------------------------------------------------------------------------
    void SetTimeScale(const float time_scale) { time_scale_ = time_scale; }

    //--------------------------------------------------------------------------------
    //  Scaled Delta timeの取得
    //--------------------------------------------------------------------------------
    float ScaledDeltaTime() const { return scaled_delta_time_; }

    //--------------------------------------------------------------------------------
    //  fps制限の設定（0 : リミットがない）
    //--------------------------------------------------------------------------------
    void SetFpsLimit(const UINT fps_limit);

    //--------------------------------------------------------------------------------
    //  タイム走る
    //--------------------------------------------------------------------------------
    void Tick();

    //--------------------------------------------------------------------------------
    //  フレーム実行出来るかをチェック
    //--------------------------------------------------------------------------------
    bool CanUpdateFrame();

private:
    //--------------------------------------------------------------------------------
    //  constructors
    //--------------------------------------------------------------------------------
    GameTimer();
    ~GameTimer();
    GameTimer(const GameTimer& rhs) = delete;
    GameTimer& operator=(const GameTimer& rhs) = delete;

    //--------------------------------------------------------------------------------
    //  Fps表示処理
    //--------------------------------------------------------------------------------
    void DisplayFps();

    //--------------------------------------------------------------------------------
    //  変数定義
    //--------------------------------------------------------------------------------
    LARGE_INTEGER frequency_;
    LARGE_INTEGER current_time_;
    LARGE_INTEGER exec_last_time_;
    LARGE_INTEGER fps_last_time_;
    float delta_time_ = 0.0f;
    float time_scale_ = 0.0f;
    float scaled_delta_time_ = 0.0f;
    float time_interval_ = 0.0f; // 更新間隔
    UINT  fps_limit_ = 0;
    bool  display_fps_ = true;
    HWND  main_window_handle_ = nullptr;

    static GameTimer* instance_; // インスタンス
};